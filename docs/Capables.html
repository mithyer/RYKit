<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ½åŠ›æ‰©å±•æ¨¡å— - RYKit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/swift.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; position: relative; }
        .back-btn { position: absolute; top: 20px; left: 20px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white; padding: 10px 20px; border-radius: 25px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; font-size: 14px; }
        .back-btn:hover { background: white; color: #667eea; transform: translateX(-5px); }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .content { padding: 40px; }
        .section { margin-bottom: 50px; }
        .section-title { font-size: 2em; color: #333; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #667eea; }
        .subsection { margin-bottom: 30px; }
        .subsection-title { font-size: 1.5em; color: #667eea; margin-bottom: 15px; }
        .description { line-height: 1.8; color: #555; margin-bottom: 20px; font-size: 1.05em; }
        .feature-list { list-style: none; margin: 20px 0; }
        .feature-list li { padding: 12px 0 12px 35px; position: relative; color: #555; line-height: 1.6; }
        .feature-list li:before { content: "âœ“"; position: absolute; left: 10px; color: #667eea; font-weight: bold; font-size: 1.2em; }
        .code-block { margin: 20px 0; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .code-header { background: #21252b; color: #abb2bf; padding: 12px 20px; font-size: 0.9em; display: flex; justify-content: space-between; align-items: center; }
        .code-lang { font-weight: bold; color: #61afef; }
        pre { margin: 0 !important; border-radius: 0 !important; }
        pre code { display: block; padding: 20px !important; font-size: 14px; line-height: 1.6; font-family: 'Monaco', 'Menlo', 'Consolas', monospace; }
        .api-table { width: 100%; border-collapse: collapse; margin: 20px 0; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); border-radius: 10px; overflow: hidden; }
        .api-table th { background: #667eea; color: white; padding: 15px; text-align: left; font-weight: 600; }
        .api-table td { padding: 15px; border-bottom: 1px solid #eee; }
        .api-table tr:last-child td { border-bottom: none; }
        .api-table tr:nth-child(even) { background: #f8f9fa; }
        .highlight-box { background: #f0f7ff; border-left: 4px solid #667eea; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .highlight-box-title { font-weight: bold; color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .tag { display: inline-block; background: #667eea; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85em; margin-right: 10px; margin-bottom: 10px; }
        @media (max-width: 768px) { .header h1 { font-size: 1.8em; } .content { padding: 20px; } .back-btn { position: static; margin-bottom: 20px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn"><span>â†</span><span>è¿”å›ç´¢å¼•</span></a>
            <h1><span>ğŸŒ</span><span>èƒ½åŠ›æ‰©å±•æ¨¡å—</span></h1>
            <p>æä¾›é¢å¤–çš„èƒ½åŠ›æ”¯æŒï¼šç½‘ç»œç›‘å¬å’Œå…³è”å¯¹è±¡</p>
        </div>

        <div class="content">
            <div class="section">
                <h2 class="section-title">æ¨¡å—æ¦‚è¿°</h2>
                <div class="description">
                    èƒ½åŠ›æ‰©å±•æ¨¡å—æä¾›ä¸¤ä¸ªå®ç”¨åŠŸèƒ½ï¼šGlobalReachabilityï¼ˆç½‘ç»œå¯è¾¾æ€§ç›‘å¬ï¼‰å’Œ Associatableï¼ˆå…³è”å¯¹è±¡åè®®ï¼‰ã€‚è¿™äº›åŠŸèƒ½å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°å¤„ç†ç½‘ç»œçŠ¶æ€å˜åŒ–å’Œä¸ºç°æœ‰ç±»æ·»åŠ åŠ¨æ€å±æ€§ã€‚
                </div>
                <div style="margin-top: 20px;">
                    <span class="tag">iOS 13.0+</span>
                    <span class="tag">macOS 10.15+</span>
                    <span class="tag">tvOS 13.0+</span>
                    <span class="tag">Swift 5.0+</span>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">å®‰è£…æ–¹å¼</h2>
                <div class="code-block">
                    <div class="code-header"><span class="code-lang">Ruby (Podfile)</span></div>
                    <pre><code class="language-ruby">pod 'RYKit/Capables'</code></pre>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">GlobalReachability - ç½‘ç»œå¯è¾¾æ€§ç›‘å¬</h2>
                
                <div class="description">
                    GlobalReachability æä¾›äº†ç®€å•æ˜“ç”¨çš„ç½‘ç»œçŠ¶æ€ç›‘å¬åŠŸèƒ½ï¼Œè‡ªåŠ¨ç®¡ç†ç›‘å¬ç”Ÿå‘½å‘¨æœŸã€‚
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ åŸºç¡€ä½¿ç”¨</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>ç›‘å¬ç½‘ç»œçŠ¶æ€</span></div>
                        <pre><code class="language-swift">import RYKit

class NetworkManager {
    var listener: AnyObject?
    
    func startMonitoring() {
        listener = GlobalReachability.shared.listen { connection in
            switch connection {
            case .wifi:
                print("âœ… WiFi å·²è¿æ¥")
                self.handleWiFiConnected()
                
            case .cellular:
                print("ğŸ“± èœ‚çªç½‘ç»œå·²è¿æ¥")
                self.handleCellularConnected()
                
            case .unavailable:
                print("âŒ ç½‘ç»œä¸å¯ç”¨")
                self.handleNetworkUnavailable()
                
            case .none:
                print("â“ æœªçŸ¥ç½‘ç»œçŠ¶æ€")
            }
        }
    }
    
    func handleWiFiConnected() {
        // å¤„ç† WiFi è¿æ¥ï¼šå¯ä»¥å¼€å§‹å¤§æ–‡ä»¶ä¸‹è½½
    }
    
    func handleCellularConnected() {
        // å¤„ç†èœ‚çªç½‘ç»œï¼šæç¤ºç”¨æˆ·æµé‡æ¶ˆè€—
    }
    
    func handleNetworkUnavailable() {
        // å¤„ç†ç½‘ç»œæ–­å¼€ï¼šæ˜¾ç¤ºç¦»çº¿æç¤º
    }
    
    deinit {
        // listener é‡Šæ”¾åè‡ªåŠ¨åœæ­¢ç›‘å¬
        listener = nil
    }
}</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ åœ¨ ViewController ä¸­ä½¿ç”¨</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>UI ä¸­ç›‘å¬ç½‘ç»œ</span></div>
                        <pre><code class="language-swift">class HomeViewController: UIViewController {
    private var networkListener: AnyObject?
    private var isNetworkAvailable = true
    
    override func viewDidLoad() {
        super.viewDidLoad()
        setupNetworkMonitoring()
    }
    
    private func setupNetworkMonitoring() {
        networkListener = GlobalReachability.shared.listen { [weak self] connection in
            DispatchQueue.main.async {
                switch connection {
                case .wifi, .cellular:
                    self?.isNetworkAvailable = true
                    self?.hideOfflineBanner()
                    self?.reloadDataIfNeeded()
                    
                case .unavailable:
                    self?.isNetworkAvailable = false
                    self?.showOfflineBanner()
                    
                case .none:
                    break
                }
            }
        }
    }
    
    private func showOfflineBanner() {
        // æ˜¾ç¤ºç¦»çº¿æç¤ºæ¨ªå¹…
    }
    
    private func hideOfflineBanner() {
        // éšè—ç¦»çº¿æç¤ºæ¨ªå¹…
    }
    
    private func reloadDataIfNeeded() {
        // ç½‘ç»œæ¢å¤åé‡æ–°åŠ è½½æ•°æ®
    }
    
    deinit {
        networkListener = nil
    }
}</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ æ ¹æ®ç½‘ç»œçŠ¶æ€ä¼˜åŒ–ä½“éªŒ</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>æ™ºèƒ½ç½‘ç»œç­–ç•¥</span></div>
                        <pre><code class="language-swift">class MediaDownloadManager {
    private var listener: AnyObject?
    private var currentConnection: SwiftReachability.Connection = .none
    
    init() {
        setupReachability()
    }
    
    private func setupReachability() {
        listener = GlobalReachability.shared.listen { [weak self] connection in
            self?.currentConnection = connection
            self?.updateDownloadStrategy()
        }
    }
    
    private func updateDownloadStrategy() {
        switch currentConnection {
        case .wifi:
            // WiFi ä¸‹å¯ç”¨é«˜æ¸…ä¸‹è½½
            enableHDDownload()
            resumeAllDownloads()
            
        case .cellular:
            // èœ‚çªç½‘ç»œä¸‹é™ä½ç”»è´¨
            disableHDDownload()
            showDataUsageWarning()
            
        case .unavailable:
            // ç½‘ç»œä¸å¯ç”¨ï¼Œæš‚åœæ‰€æœ‰ä¸‹è½½
            pauseAllDownloads()
            
        case .none:
            break
        }
    }
    
    func downloadMedia(url: URL) {
        guard currentConnection != .unavailable else {
            showNoNetworkError()
            return
        }
        
        if currentConnection == .cellular {
            // èœ‚çªç½‘ç»œä¸‹è¯¢é—®ç”¨æˆ·
            askUserBeforeDownload(url)
        } else {
            // WiFi ä¸‹ç›´æ¥ä¸‹è½½
            startDownload(url)
        }
    }
    
    private func enableHDDownload() { }
    private func disableHDDownload() { }
    private func showDataUsageWarning() { }
    private func pauseAllDownloads() { }
    private func resumeAllDownloads() { }
    private func showNoNetworkError() { }
    private func askUserBeforeDownload(_ url: URL) { }
    private func startDownload(_ url: URL) { }
}</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“‹ ç½‘ç»œè¿æ¥ç±»å‹</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th style="width: 30%;">ç±»å‹</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>.wifi</code></td>
                                <td>WiFi è¿æ¥</td>
                            </tr>
                            <tr>
                                <td><code>.cellular</code></td>
                                <td>èœ‚çªç½‘ç»œè¿æ¥ï¼ˆ3G/4G/5Gï¼‰</td>
                            </tr>
                            <tr>
                                <td><code>.unavailable</code></td>
                                <td>ç½‘ç»œä¸å¯ç”¨</td>
                            </tr>
                            <tr>
                                <td><code>.none</code></td>
                                <td>æœªçŸ¥çŠ¶æ€</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Associatable - å…³è”å¯¹è±¡åè®®</h2>
                
                <div class="description">
                    Associatable åè®®å…è®¸ä¸ºä»»æ„ç±»åŠ¨æ€æ·»åŠ å±æ€§ï¼Œæ— éœ€ç»§æ‰¿æˆ–ä¿®æ”¹åŸç±»ã€‚è¿™åœ¨å¤„ç†ä¸èƒ½ä¿®æ”¹æºä»£ç çš„ç±»æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ åŸºç¡€ä½¿ç”¨</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>æ·»åŠ å…³è”å±æ€§</span></div>
                        <pre><code class="language-swift">import RYKit
import UIKit

// è®© UIView éµå¾ª Associatable
extension UIView: Associatable {}

// ä½¿ç”¨ç¤ºä¾‹
let view = UIView()

// å­˜å‚¨å…³è”å€¼
view.setAssociated("customID", value: "VIEW_001")
view.setAssociated("userData", value: ["name": "å¼ ä¸‰", "age": 25])
view.setAssociated("tapCount", value: 0)

// è¯»å–å…³è”å€¼
let id: String? = view.associated("customID", initializer: nil)
print(id)  // "VIEW_001"

let userData: [String: Any]? = view.associated("userData", initializer: nil)
print(userData)  // ["name": "å¼ ä¸‰", "age": 25]

var count: Int? = view.associated("tapCount", initializer: nil)
count = (count ?? 0) + 1
view.setAssociated("tapCount", value: count)</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ ä½¿ç”¨ç±»å‹æ¨æ–­ç®€åŒ–ä»£ç </h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>è‡ªåŠ¨ç±»å‹æ¨æ–­</span></div>
                        <pre><code class="language-swift">extension UIView: Associatable {}

let view = UIView()

// é€šè¿‡ initializer æä¾›é»˜è®¤å€¼
let count: Int = view.associated(initializer: 0)  // key è‡ªåŠ¨ä¸º "Int"
let name: String = view.associated(initializer: "")  // key è‡ªåŠ¨ä¸º "String"

// æ›´æ–°å€¼
view.setAssociated(value: count + 1)
view.setAssociated(value: "æ–°åç§°")</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ å®é™…åº”ç”¨ï¼šä¸º UIButton æ·»åŠ é—­åŒ…å›è°ƒ</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>é—­åŒ…å¼æŒ‰é’®å›è°ƒ</span></div>
                        <pre><code class="language-swift">extension UIButton: Associatable {
    // æ·»åŠ  tapHandler å±æ€§
    var tapHandler: (() -> Void)? {
        get {
            return associated("tapHandler", initializer: nil)
        }
        set {
            setAssociated("tapHandler", value: newValue)
            
            // ç§»é™¤æ—§çš„ target
            removeTarget(nil, action: nil, for: .touchUpInside)
            
            // æ·»åŠ æ–°çš„ target
            if newValue != nil {
                addTarget(self, action: #selector(handleTap), for: .touchUpInside)
            }
        }
    }
    
    @objc private func handleTap() {
        tapHandler?()
    }
}

// ä½¿ç”¨ç¤ºä¾‹
let button = UIButton()
button.tapHandler = {
    print("æŒ‰é’®è¢«ç‚¹å‡»äº†")
}

// ç®€æ´çš„è¯­æ³•ï¼Œä¸éœ€è¦ addTarget/action
let submitButton = UIButton()
submitButton.tapHandler = { [weak self] in
    self?.submitForm()
}</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ ä¸º UITableViewCell æ·»åŠ æ•°æ®å…³è”</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>Cell æ•°æ®ç»‘å®š</span></div>
                        <pre><code class="language-swift">extension UITableViewCell: Associatable {}

class CustomCell: UITableViewCell {
    var model: CellModel? {
        get {
            return associated("model", initializer: nil)
        }
        set {
            setAssociated("model", value: newValue)
            updateUI()
        }
    }
    
    private func updateUI() {
        guard let model = model else { return }
        textLabel?.text = model.title
        detailTextLabel?.text = model.subtitle
    }
}

// ä½¿ç”¨
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    let cell = tableView.dequeueReusableCell(withIdentifier: "Cell", for: indexPath) as! CustomCell
    cell.model = dataSource[indexPath.row]
    return cell
}</code></pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">ğŸ“ ä¸º UIViewController æ·»åŠ æ ‡è¯†</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">Swift</span><span>ViewController å…ƒæ•°æ®</span></div>
                        <pre><code class="language-swift">extension UIViewController: Associatable {
    var screenName: String? {
        get { associated("screenName", initializer: nil) }
        set { setAssociated("screenName", value: newValue) }
    }
    
    var analyticsData: [String: Any]? {
        get { associated("analyticsData", initializer: nil) }
        set { setAssociated("analyticsData", value: newValue) }
    }
}

// ä½¿ç”¨
class ProfileViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()
        
        screenName = "Profile"
        analyticsData = [
            "userId": UserManager.shared.currentUserId,
            "source": "main_tab"
        ]
    }
    
    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)
        
        // ç»Ÿä¸€çš„é¡µé¢è®¿é—®ç»Ÿè®¡
        if let screenName = screenName {
            AnalyticsManager.shared.trackScreen(
                name: screenName,
                data: analyticsData
            )
        }
    }
}</code></pre>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">API å‚è€ƒ</h2>
                
                <div class="subsection">
                    <h3 class="subsection-title">GlobalReachability</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th style="width: 40%;">æ–¹æ³•/å±æ€§</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>static var shared</code></td>
                                <td>å…¨å±€å•ä¾‹</td>
                            </tr>
                            <tr>
                                <td><code>listen(_:)</code></td>
                                <td>ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–ï¼Œè¿”å› listener å¯¹è±¡</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">Associatable</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th style="width: 50%;">æ–¹æ³•</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>associated&lt;T&gt;(_:initializer:)</code></td>
                                <td>è·å–å…³è”å€¼ï¼Œä¸å­˜åœ¨æ—¶ä½¿ç”¨ initializer</td>
                            </tr>
                            <tr>
                                <td><code>setAssociated&lt;T&gt;(_:value:)</code></td>
                                <td>è®¾ç½®å…³è”å€¼</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">æœ€ä½³å®è·µ</h2>
                
                <div class="highlight-box">
                    <div class="highlight-box-title">ğŸ’¡ GlobalReachability æ¨èåšæ³•</div>
                    <ul class="feature-list" style="margin: 10px 0;">
                        <li>ä¿æŒ listener å¼•ç”¨ä»¥ç»´æŒç›‘å¬</li>
                        <li>åœ¨å›è°ƒä¸­ä½¿ç”¨ weak self é¿å…å¾ªç¯å¼•ç”¨</li>
                        <li>WiFi å’Œèœ‚çªç½‘ç»œé‡‡ç”¨ä¸åŒçš„ç­–ç•¥</li>
                        <li>ç½‘ç»œæ¢å¤åé€‚æ—¶é‡æ–°åŠ è½½æ•°æ®</li>
                        <li>ç»™ç”¨æˆ·å‹å¥½çš„ç½‘ç»œçŠ¶æ€æç¤º</li>
                    </ul>
                </div>

                <div class="highlight-box">
                    <div class="highlight-box-title">ğŸ’¡ Associatable æ¨èåšæ³•</div>
                    <ul class="feature-list" style="margin: 10px 0;">
                        <li>ä½¿ç”¨æœ‰æ„ä¹‰çš„ key åç§°</li>
                        <li>é€šè¿‡æ‰©å±•å°è£…ä¸ºè®¡ç®—å±æ€§</li>
                        <li>æ³¨æ„ç±»å‹å®‰å…¨ï¼Œä½¿ç”¨æ˜ç¡®çš„æ³›å‹</li>
                        <li>ä¸è¦å­˜å‚¨å¤§é‡æ•°æ®ï¼Œå½±å“æ€§èƒ½</li>
                        <li>é€‚åˆå­˜å‚¨ä¸´æ—¶çŠ¶æ€æˆ–å…ƒæ•°æ®</li>
                        <li>å¯¹è±¡é‡Šæ”¾æ—¶å…³è”æ•°æ®ä¼šè‡ªåŠ¨æ¸…ç†</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
